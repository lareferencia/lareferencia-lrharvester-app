<?xml version="1.0" encoding="UTF-8"?>


<!--
  ~   Copyright (c) 2013-2022. LA Referencia / Red CLARA and others
  ~
  ~   This program is free software: you can redistribute it and/or modify
  ~   it under the terms of the GNU Affero General Public License as published by
  ~   the Free Software Foundation, either version 3 of the License, or
  ~   (at your option) any later version.
  ~
  ~   This program is distributed in the hope that it will be useful,
  ~   but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~   GNU Affero General Public License for more details.
  ~
  ~   You should have received a copy of the GNU Affero General Public License
  ~   along with this program.  If not, see <http://www.gnu.org/licenses/>.
  ~
  ~   This file is part of LA Referencia software platform LRHarvester v4.x
  ~   For any further information please contact Lautaro Matas <lmatas@gmail.com>
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jpa="http://www.springframework.org/schema/data/jpa" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:jdbc="http://www.springframework.org/schema/jdbc" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:solr="http://www.springframework.org/schema/data/solr"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd
		http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa.xsd
		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
		
		
	<!-- =====================================================================
	     SEMANTIC INDEXING ACTIONS
	     
	     This configuration enables semantic search indexing using dense vectors.
	     Records are indexed with embedding vectors generated from title fields
	     via an external embedding API.
	     
	     Required configuration in application.properties:
	       - frontend.solr.url: Solr URL for biblio core
	       - embedding.api.url: URL of the embedding generation API
	     
	     Solr schema requirements:
	       - Field 'semantic_vector' of type DenseVectorField (768 dimensions)
	     ===================================================================== -->
	
	<!-- ACTIONS -->		
	<bean id="semanticIndexingNetworkAction" class="org.lareferencia.core.task.NetworkAction">
    	<property name="name" value="SEMANTIC_INDEXING_ACTION"/>
    	<property name="description" value="Index Semantic Search"></property>
    	<property name="incremental" value="true"/>
    	<property name="runOnSchedule" value="false"/>
    	<property name="workers">
        <list>
        	<value>semanticIndexerWorker</value>
        </list>
    	</property>
    	<property name="properties">
        <list>
        	<bean class="org.lareferencia.core.task.NetworkProperty">
        		<property name="name" value="INDEX_SEMANTIC" />
        		<property name="description" value="Indexar con vectores semÃ¡nticos?" />
        	</bean>
        </list>
        </property> 
    </bean>
    
		
	<bean id="semanticDeleteAction" class="org.lareferencia.core.task.NetworkAction">
    	<property name="name" value="SEMANTIC_DELETE_ACTION"/>
    	<property name="description" value="UnIndex Semantic"></property>
    	<property name="workers">
        <list>
        	<value>semanticDeleteWorker</value>
        </list>
    	</property>
    </bean>
		    
		
    <!-- WORKERS -->
	<bean id="semanticIndexerWorker" class="org.lareferencia.core.worker.indexing.SemanticIndexerWorker"
		scope="prototype">

		<property name="serialLaneId" value="1"/>
		<property name="targetSchemaName" value="vufind4"/>
		
		<property name="solrNetworkIDField" value="network_acronym_str"/>

		<property name="pageSize" value="100"/>
		
		<property name="executeDeletion" value="true" />
		<property name="executeIndexing" value="true" />
		
		<property name="indexNetworkAttributes" value="true" />
		
		<!-- Semantic Indexing Configuration -->
		<property name="embeddingApiUrl" value="${embedding.api.url}" />
		<property name="sourceFieldForEmbedding" value="dc.title.*" />
		<property name="vectorFieldName" value="vector" />
		<property name="embeddingApiTimeoutSeconds" value="30" />
		<property name="skipOnEmbeddingFailure" value="true" />

	</bean>
	

	<bean id="semanticDeleteWorker" class="org.lareferencia.core.worker.indexing.FullUnindexerWorker"
		scope="prototype">
		<constructor-arg>
			<value>${frontend.solr.url}</value>
		</constructor-arg>
		
		<property name="serialLaneId" value="1"/>
		
		<property name="solrNetworkIDField" value="network_acronym_str"/>
		<property name="solrRecordIDField" value="id"/>
		
	</bean>
	
	
</beans>
